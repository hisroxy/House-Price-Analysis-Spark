{"remainingRequest":"E:\\House-Price-Analysis-Spark\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\House-Price-Analysis-Spark\\frontend\\src\\views\\User.vue?vue&type=style&index=0&id=e0b47cf6&scoped=true&lang=css","dependencies":[{"path":"E:\\House-Price-Analysis-Spark\\frontend\\src\\views\\User.vue","mtime":1770738275183},{"path":"E:\\House-Price-Analysis-Spark\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1769265187885},{"path":"E:\\House-Price-Analysis-Spark\\frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1769265187974},{"path":"E:\\House-Price-Analysis-Spark\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1769265187675},{"path":"E:\\House-Price-Analysis-Spark\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1769265189153},{"path":"E:\\House-Price-Analysis-Spark\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1769265187754}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci51c2VyLWNvbnRhaW5lciB7CiAgcGFkZGluZzogMjBweDsKICBtYXgtd2lkdGg6IDgwMHB4OwogIG1hcmdpbjogMCBhdXRvOwp9CgoudXNlci1jb250YWluZXIgaDEgewogIGNvbG9yOiAjMzMzOwogIGZvbnQtc2l6ZTogMjRweDsKICBtYXJnaW4tYm90dG9tOiA4cHg7Cn0KCi51c2VyLWNvbnRhaW5lciBwIHsKICBjb2xvcjogIzY2NjsKICBmb250LXNpemU6IDE0cHg7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKfQoKLmF2YXRhci1wcmV2aWV3LXNlY3Rpb24gewogIG1hcmdpbi1ib3R0b206IDI0cHg7Cn0KCi5hdmF0YXItcHJldmlldy1ib3ggewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDIwcHg7CiAgYmFja2dyb3VuZDogI2Y1ZjdmYTsKICBib3JkZXItcmFkaXVzOiAxMnB4OwogIHBhZGRpbmc6IDIwcHg7Cn0KCi5hdmF0YXItaW1hZ2UgewogIHdpZHRoOiAxMjBweDsKICBoZWlnaHQ6IDEyMHB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBvYmplY3QtZml0OiBjb3ZlcjsKICBib3JkZXI6IDJweCBzb2xpZCAjZTFlNWU5OwogIGJveC1zaGFkb3c6IDAgNHB4IDhweCByZ2JhKDAsMCwwLDAuMSk7Cn0KCi5hdmF0YXItaW5mbyB7CiAgdGV4dC1hbGlnbjogbGVmdDsKfQoKLmF2YXRhci10ZXh0IHsKICBjb2xvcjogIzMzMzsKICBmb250LXdlaWdodDogNTAwOwogIG1hcmdpbi1ib3R0b206IDRweDsKfQoKLmF2YXRhci1kZXNjIHsKICBjb2xvcjogIzY2NjsKICBmb250LXNpemU6IDEycHg7Cn0KCi5hdmF0YXItcHJldmlldy1yZXN1bHQgewogIG1hcmdpbi10b3A6IDEwcHg7CiAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgoucHJldmlldy1pbWFnZSB7CiAgd2lkdGg6IDgwcHg7CiAgaGVpZ2h0OiA4MHB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBvYmplY3QtZml0OiBjb3ZlcjsKICBib3JkZXI6IDJweCBzb2xpZCAjZTFlNWU5OwogIGJveC1zaGFkb3c6IDAgMnB4IDZweCByZ2JhKDAsMCwwLDAuMSk7CiAgbWFyZ2luLWJvdHRvbTogOHB4Owp9CgoucHJldmlldy1zdGF0dXMgewogIGZvbnQtc2l6ZTogMTJweDsKICBmb250LXdlaWdodDogNTAwOwp9CgoucHJldmlldy1zdGF0dXMuc3VjY2VzcyB7CiAgY29sb3I6ICM2N2MyM2E7Cn0KCi5wcmV2aWV3LXN0YXR1cy5lcnJvciB7CiAgY29sb3I6ICNmNTZjNmM7Cn0KCi5wcmV2aWV3LXN0YXR1cy5sb2FkaW5nIHsKICBjb2xvcjogIzQwOWVmZjsKfQoKLnVzZXItZm9ybSB7CiAgYmFja2dyb3VuZDogd2hpdGU7CiAgYm9yZGVyLXJhZGl1czogMTJweDsKICBwYWRkaW5nOiAyNHB4OwogIGJveC1zaGFkb3c6IDAgNHB4IDE1cHggcmdiYSgwLDAsMCwwLjEpOwp9CgouZm9ybS1hY3Rpb25zIHsKICBtYXJnaW4tdG9wOiAyMHB4Owp9Cg=="},{"version":3,"sources":["User.vue"],"names":[],"mappings":";AAoRA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"User.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"user-container\">\n    <h1>个人信息</h1>\n    <p>修改您的个人资料</p>\n    \n    <!-- 头像预览区域 -->\n    <div class=\"avatar-preview-section\">\n      <div class=\"avatar-preview-box\">\n        <img \n          :src=\"formData.avatar || 'https://ss2.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1659552792,3869332496&fm=253&gp=0.jpg'\" \n          :alt=\"formData.nickname || formData.username\" \n          class=\"avatar-image\"\n          @error=\"handleAvatarError\"\n        />\n        <div class=\"avatar-info\">\n          <p class=\"avatar-text\">头像预览</p>\n          <p class=\"avatar-desc\">支持外部图片链接</p>\n        </div>\n      </div>\n    </div>\n    \n    <el-form :model=\"formData\" ref=\"userForm\" label-width=\"100px\" class=\"user-form\">\n      <el-row :gutter=\"20\">\n        <el-col :span=\"12\">\n          <el-form-item label=\"用户名\" prop=\"username\">\n            <el-input v-model=\"formData.username\" disabled />\n          </el-form-item>\n          <el-form-item label=\"邮箱\" prop=\"email\">\n            <el-input v-model=\"formData.email\" />\n          </el-form-item>\n          <el-form-item label=\"手机号\" prop=\"phone\">\n            <el-input v-model=\"formData.phone\" />\n          </el-form-item>\n          <el-form-item label=\"性别\" prop=\"gender\">\n            <el-select v-model=\"formData.gender\">\n              <el-option label=\"男\" value=\"男\"></el-option>\n              <el-option label=\"女\" value=\"女\"></el-option>\n              <el-option label=\"未知\" value=\"未知\"></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        \n        <el-col :span=\"12\">\n          <el-form-item label=\"昵称\" prop=\"nickname\">\n            <el-input v-model=\"formData.nickname\" />\n          </el-form-item>\n          <el-form-item label=\"城市\" prop=\"city\">\n            <el-input v-model=\"formData.city\" />\n          </el-form-item>\n          <el-form-item label=\"头像URL\" prop=\"avatar\">\n            <el-input \n              v-model=\"formData.avatar\" \n              placeholder=\"请输入图片URL地址\"\n              @input=\"handleAvatarInput\"\n            >\n              <template #append>\n                <el-button @click=\"loadAvatarPreview\" :loading=\"avatarLoading\">加载</el-button>\n              </template>\n            </el-input>\n            <div v-if=\"avatarPreviewUrl\" class=\"avatar-preview-result\">\n              <img \n                :src=\"avatarPreviewUrl\" \n                alt=\"头像预览\" \n                class=\"preview-image\"\n                @error=\"handlePreviewError\"\n                @load=\"handlePreviewLoad\"\n              />\n              <span class=\"preview-status success\" v-if=\"previewLoaded\">✓ 预览成功</span>\n              <span class=\"preview-status error\" v-else-if=\"previewError\">✗ 加载失败</span>\n              <span class=\"preview-status loading\" v-else>加载中...</span>\n            </div>\n          </el-form-item>\n          <el-form-item label=\"出生日期\" prop=\"birth_date\">\n            <el-date-picker v-model=\"formData.birth_date\" type=\"date\" value-format=\"yyyy-MM-dd\" />\n          </el-form-item>\n        </el-col>\n      </el-row>\n      \n      <div class=\"form-actions\">\n        <el-button type=\"primary\" @click=\"saveUserInfo\" :loading=\"loading\">保存修改</el-button>\n        <el-button @click=\"resetForm\">重置</el-button>\n        <el-button @click=\"$router.push('/')\">返回</el-button>\n      </div>\n    </el-form>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'User',\n  data() {\n    return {\n      formData: {\n        username: '',\n        email: '',\n        phone: '',\n        gender: '未知',\n        nickname: '',\n        city: '',\n        avatar: '',\n        birth_date: ''\n      },\n      loading: false,\n      user: {},\n      avatarPreviewUrl: '',\n      avatarLoading: false,\n      previewLoaded: false,\n      previewError: false\n    }\n  },\n  async mounted() {\n    await this.loadUserInfo()\n  },\n  methods: {\n    async loadUserInfo() {\n      try {\n        const userInfo = localStorage.getItem('userInfo')\n        if (userInfo) {\n          this.user = JSON.parse(userInfo)\n          this.formData = {\n            username: this.user.username || '',\n            email: this.user.email || '',\n            phone: this.user.phone || '',\n            gender: this.user.gender || '未知',\n            nickname: this.user.nickname || '',\n            city: this.user.city || '',\n            avatar: this.user.avatar || '',\n            birth_date: this.user.birth_date || ''\n          }\n        } else {\n          const response = await this.$http.get('/api/user/user-info/')\n          if (response.data.success) {\n            this.user = response.data.data\n            this.formData = {\n              username: this.user.username || '',\n              email: this.user.email || '',\n              phone: this.user.phone || '',\n              gender: this.user.gender || '未知',\n              nickname: this.user.nickname || '',\n              city: this.user.city || '',\n              avatar: this.user.avatar || '',\n              birth_date: this.user.birth_date || ''\n            }\n          }\n        }\n        // 初始化头像预览\n        if (this.formData.avatar) {\n          this.avatarPreviewUrl = this.formData.avatar\n          this.loadAvatarPreview()\n        }\n      } catch (error) {\n        console.error('加载用户信息失败:', error)\n        this.$message.error('加载用户信息失败')\n      }\n    },\n    \n    handleAvatarInput(value) {\n      // 输入时实时更新预览URL\n      this.avatarPreviewUrl = value\n      this.previewLoaded = false\n      this.previewError = false\n      \n      // 如果有内容，自动尝试加载\n      if (value && value.trim()) {\n        this.debounceLoadPreview()\n      }\n    },\n    \n    debounceLoadPreview() {\n      // 防抖处理，避免频繁请求\n      clearTimeout(this.previewTimer)\n      this.previewTimer = setTimeout(() => {\n        this.loadAvatarPreview()\n      }, 500)\n    },\n    \n    async loadAvatarPreview() {\n      if (!this.formData.avatar || !this.formData.avatar.trim()) {\n        this.avatarPreviewUrl = ''\n        this.previewLoaded = false\n        this.previewError = false\n        return\n      }\n      \n      this.avatarLoading = true\n      this.previewError = false\n      \n      try {\n        // 创建一个测试图片来验证URL是否有效\n        const img = new Image()\n        img.onload = () => {\n          this.previewLoaded = true\n          this.avatarLoading = false\n          this.previewError = false\n          this.$message.success('头像预览加载成功')\n        }\n        img.onerror = () => {\n          this.previewError = true\n          this.avatarLoading = false\n          this.previewLoaded = false\n          this.$message.error('头像URL无效或无法访问')\n        }\n        img.src = this.formData.avatar\n      } catch (error) {\n        this.previewError = true\n        this.avatarLoading = false\n        this.previewLoaded = false\n        this.$message.error('头像加载失败')\n      }\n    },\n    \n    handlePreviewLoad() {\n      this.previewLoaded = true\n      this.previewError = false\n    },\n    \n    handlePreviewError() {\n      this.previewError = true\n      this.previewLoaded = false\n    },\n    \n    handleAvatarError(event) {\n      // 头像加载失败时显示默认头像\n      event.target.src = 'https://ss2.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1659552792,3869332496&fm=253&gp=0.jpg'\n\n      this.$message.warning('头像加载失败，已使用默认头像')\n    },\n    \n    async saveUserInfo() {\n      this.loading = true\n      try {\n        const response = await this.$http.put('/api/user/update-info/', {\n          email: this.formData.email,\n          phone: this.formData.phone,\n          gender: this.formData.gender,\n          nickname: this.formData.nickname,\n          city: this.formData.city,\n          avatar: this.formData.avatar,\n          birth_date: this.formData.birth_date\n        })\n        \n        if (response.data.success) {\n          this.$message.success('保存成功！')\n          \n          // 更新localStorage\n          const updatedUser = { ...this.user, ...this.formData }\n          localStorage.setItem('userInfo', JSON.stringify(updatedUser))\n          this.user = updatedUser\n        } else {\n          this.$message.error(response.data.message || '保存失败')\n        }\n      } catch (error) {\n        console.error('保存失败:', error)\n        this.$message.error('网络错误，请稍后重试')\n      } finally {\n        this.loading = false\n      }\n    },\n    \n    resetForm() {\n      this.formData = {\n        username: this.user.username || '',\n        email: this.user.email || '',\n        phone: this.user.phone || '',\n        gender: this.user.gender || '未知',\n        nickname: this.user.nickname || '',\n        city: this.user.city || '',\n        avatar: this.user.avatar || '',\n        birth_date: this.user.birth_date || ''\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.user-container {\n  padding: 20px;\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.user-container h1 {\n  color: #333;\n  font-size: 24px;\n  margin-bottom: 8px;\n}\n\n.user-container p {\n  color: #666;\n  font-size: 14px;\n  margin-bottom: 20px;\n}\n\n.avatar-preview-section {\n  margin-bottom: 24px;\n}\n\n.avatar-preview-box {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  background: #f5f7fa;\n  border-radius: 12px;\n  padding: 20px;\n}\n\n.avatar-image {\n  width: 120px;\n  height: 120px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid #e1e5e9;\n  box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n}\n\n.avatar-info {\n  text-align: left;\n}\n\n.avatar-text {\n  color: #333;\n  font-weight: 500;\n  margin-bottom: 4px;\n}\n\n.avatar-desc {\n  color: #666;\n  font-size: 12px;\n}\n\n.avatar-preview-result {\n  margin-top: 10px;\n  text-align: center;\n}\n\n.preview-image {\n  width: 80px;\n  height: 80px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid #e1e5e9;\n  box-shadow: 0 2px 6px rgba(0,0,0,0.1);\n  margin-bottom: 8px;\n}\n\n.preview-status {\n  font-size: 12px;\n  font-weight: 500;\n}\n\n.preview-status.success {\n  color: #67c23a;\n}\n\n.preview-status.error {\n  color: #f56c6c;\n}\n\n.preview-status.loading {\n  color: #409eff;\n}\n\n.user-form {\n  background: white;\n  border-radius: 12px;\n  padding: 24px;\n  box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n}\n\n.form-actions {\n  margin-top: 20px;\n}\n</style>"]}]}